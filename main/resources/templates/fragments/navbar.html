<!-- Navbar fragment -->
<div th:fragment="navbar" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
  <header class="bg-white shadow-md sticky top-0 z-50">
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <!-- Brand link: route users to role-specific home pages -->
        <span sec:authorize="hasRole('HOCVIEN')">
          <a th:href="@{/hocvien/home}" class="text-3xl font-bold" style="color: #00C853;">Guitar üé∏</a>
        </span>
        <span sec:authorize="hasRole('GIAOVIEN')">
          <a th:href="@{/giaovien/home}" class="text-3xl font-bold" style="color: #00C853;">Guitar üé∏</a>
        </span>
        <span sec:authorize="isAnonymous() or hasRole('ADMIN')">
          <a th:href="@{/}" class="text-3xl font-bold" style="color: #00C853;">Guitar üé∏</a>
        </span>
      <div class="hidden md:flex md:items-center md:space-x-6">
        <!-- role-aware home link -->
        <span sec:authorize="hasRole('HOCVIEN')">
          <a th:href="@{/hocvien/home}" class="text-gray-700 hover:text-green-600 transition">Trang ch·ªß</a>
        </span>
        <span sec:authorize="hasRole('GIAOVIEN')">
          <a th:href="@{/giaovien/home}" class="text-gray-700 hover:text-green-600 transition">Trang ch·ªß</a>
        </span>
        <span sec:authorize="isAnonymous() or hasRole('ADMIN')">
          <a th:href="@{/}" class="text-gray-700 hover:text-green-600 transition">Trang ch·ªß</a>
        </span>
          <a th:href="@{/khoahoc}" class="text-gray-700 hover:text-green-600 transition">Kh√≥a h·ªçc</a>
          <a th:href="@{/giaovien}" class="text-gray-700 hover:text-green-600 transition">Gi√°o vi√™n</a>
          <a th:href="@{/gioithieu}" class="text-gray-700 hover:text-green-600 transition">Gi·ªõi thi·ªáu</a>

          <!-- Login / Logout -->
          <span sec:authorize="isAnonymous()">
            <a id="nav-login-link" th:href="@{/login}" class="px-4 py-2 rounded-md font-semibold" style="background-color: #00C853; color: white;">ƒêƒÉng nh·∫≠p</a>
          </span>
          <span sec:authorize="isAuthenticated()" class="flex items-center gap-3">
            <span id="nav-greeting" class="text-gray-700">Xin ch√†o, <strong><span sec:authentication="name">User</span></strong></span>
            <form id="nav-logout-form" th:action="@{/logout}" method="post" style="display:inline">
              <button type="submit" class="px-4 py-2 rounded-md font-semibold" style="background-color: #e53935; color: white;">ƒêƒÉng xu·∫•t</button>
            </form>
          </span>

          <script>
              // Fallback: client-side visibility guard for login/logout links.
              // If the server rendered the authenticated greeting, hide the login link.
              // Otherwise (no greeting), hide the logout form so anonymous users don't see it.
              document.addEventListener('DOMContentLoaded', function(){
                  try{
                      var loginLink = document.getElementById('nav-login-link');
                      var greeting = document.getElementById('nav-greeting');
                      var logoutForm = document.getElementById('nav-logout-form');

                      if(greeting && greeting.offsetParent !== null){
                          // User is authenticated (greeting is visible)
                          if(loginLink){ loginLink.style.display = 'none'; }
                          if(logoutForm){ /* leave logout visible when greeting exists */ }
                      } else {
                          // Not authenticated (server did not render greeting or it's hidden)
                          if(logoutForm){ logoutForm.style.display = 'none'; }
                          if(loginLink){ loginLink.style.display = 'block'; }
                      }
                  }catch(e){ /* ignore errors silently */ }
              });
          </script>
      </div>
    </nav>
  </header>
</div>
