package com.guitar.management.repository;

import static org.junit.jupiter.api.Assertions.*;

import java.util.Date;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import com.guitar.management.model.HocVien;
import com.guitar.management.model.KhoaHoc;
import com.guitar.management.model.Lesson;
import com.guitar.management.model.HocVienKhoaHoc;

class HVKHRepositoryTest {

	private HVKHRepository repo;

	@BeforeEach
	void setUp() {
		repo = new HVKHRepository();
	}

	@Test
	void addAndGetById() {
		HocVien hv = new HocVien(1, "HV", "hv@example.com", "0123");
		KhoaHoc kh = new KhoaHoc(1, "KH", "d", null);
		Lesson l = new Lesson(1, "L", "nd", 10);
		HocVienKhoaHoc hvkh = new HocVienKhoaHoc(1, hv, kh, l, new Date(), "Dang hoc");
		repo.addHocVienKhoaHoc(hvkh);
		HocVienKhoaHoc found = repo.getHocVienKhoaHocById(1);
		assertNotNull(found);
		assertEquals("Dang hoc", found.getTrangThai());
	}

	@Test
	void updateAndDelete() {
		HocVien hv = new HocVien(2, "HV2", "hv2@example.com", "0000");
		KhoaHoc kh = new KhoaHoc(2, "KH2", "d", null);
		Lesson l = new Lesson(2, "L2", "nd", 20);
		HocVienKhoaHoc hvkh = new HocVienKhoaHoc(2, hv, kh, l, new Date(), "Dang hoc");
		repo.addHocVienKhoaHoc(hvkh);

		HocVienKhoaHoc updated = new HocVienKhoaHoc(2, hv, kh, l, new Date(), "Hoan thanh");
		boolean ok = repo.updateHocVienKhoaHoc(2, updated);
		assertTrue(ok);
		assertEquals("Hoan thanh", repo.getHocVienKhoaHocById(2).getTrangThai());

		boolean removed = repo.deleteHocVienKhoaHoc(2);
		assertTrue(removed);
		assertNull(repo.getHocVienKhoaHocById(2));
	}
}